<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>üå∏ Laporan Mingguan Cute Mode</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Comic Sans MS', cursive, sans-serif;
      background: linear-gradient(135deg, #ffe6f0, #e6f7ff);
      color: #333;
      padding: 20px;
      transition: background 0.5s, color 0.5s;
    }
    .card {
      background: white;
      max-width: 600px;
      margin: auto;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      color: #ff69b4;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }
    th {
      background: #f9d1ec;
    }
    .button-primary {
      background-color: #ffb6c1;
      color: white;
      border: none;
    }
    .button-primary:hover {
      background-color: #ff69b4;
    }
    #statusChart {
      max-width: 300px;
      margin: 20px auto;
    }
  </style>
</head>
<body>
  <h1>üå∏ Laporan Mingguan</h1>
  <div class="card">
    <label>Tanggal: <input type="date" id="tanggal"></label>
    <label>Hari: <input type="text" id="hari"></label>
    <label>Masalah: <input type="text" id="masalah"></label>
    <label>Eksekusi: <input type="text" id="eksekusi"></label>
    <label>Keterangan:
      <select id="keterangan">
        <option value="Belum Selesai">Belum Selesai</option>
        <option value="Proses">Proses</option>
        <option value="Selesai">Selesai</option>
      </select>
    </label>
    <button class="button-primary" onclick="tambahData()">‚ûï Tambah</button>
    <button onclick="exportExcel()">üìÅ Export Excel</button>
    <br><br>
    <label>Filter Status:
      <select id="filterStatus" onchange="renderTable()">
        <option value="">Semua</option>
        <option value="Belum Selesai">Belum Selesai</option>
        <option value="Proses">Proses</option>
        <option value="Selesai">Selesai</option>
      </select>
    </label>
    <table id="tabel">
      <thead>
        <tr>
          <th>Tanggal</th>
          <th>Hari</th>
          <th>Masalah</th>
          <th>Eksekusi</th>
          <th>Keterangan</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <canvas id="statusChart"></canvas>
<script>
const SHEET_URL = "https://script.google.com/macros/s/AKfycbymcCOQom8uu1JzU34UzZUquYuLiz4hxtl_l4cWR-Q/exec";
let data = [];

async function loadData() {
  const res = await fetch(SHEET_URL);
  data = await res.json();
  renderTable();
  updateChart();
}

async function tambahData() {
  const tanggal = document.getElementById("tanggal").value;
  const hari = document.getElementById("hari").value;
  const masalah = document.getElementById("masalah").value;
  const eksekusi = document.getElementById("eksekusi").value;
  const keterangan = document.getElementById("keterangan").value;

  await fetch(SHEET_URL, {
    method: "POST",
    body: JSON.stringify({ tanggal, hari, masalah, eksekusi, keterangan }),
    headers: { "Content-Type": "application/json" }
  });
  await loadData();
}

function renderTable() {
  const tbody = document.querySelector("#tabel tbody");
  const filter = document.getElementById("filterStatus").value;
  tbody.innerHTML = "";
  data.forEach(row => {
    if (!filter || row.keterangan === filter) {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${row.tanggal}</td>
        <td>${row.hari}</td>
        <td>${row.masalah}</td>
        <td>${row.eksekusi}</td>
        <td>${row.keterangan}</td>
      `;
      tbody.appendChild(tr);
    }
  });
}

function exportExcel() {
  const ws_data = [["Tanggal", "Hari", "Masalah", "Eksekusi", "Keterangan"]];
  data.forEach(row => {
    ws_data.push([row.tanggal, row.hari, row.masalah, row.eksekusi, row.keterangan]);
  });
  const wb = XLSX.utils.book_new();
  const ws = XLSX.utils.aoa_to_sheet(ws_data);
  XLSX.utils.book_append_sheet(wb, ws, "Laporan");
  XLSX.writeFile(wb, "laporan-cute.xlsx");
}

function updateChart() {
  const count = { "Selesai": 0, "Proses": 0, "Belum Selesai": 0 };
  data.forEach(row => count[row.keterangan]++);
  const ctx = document.getElementById("statusChart").getContext("2d");
  if (window.statusChart) window.statusChart.destroy();
  window.statusChart = new Chart(ctx, {
    type: "pie",
    data: {
      labels: Object.keys(count),
      datasets: [{
        data: Object.values(count),
        backgroundColor: ["#98FB98", "#FFD700", "#FF7F7F"]
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { position: "bottom" } }
    }
  });
}

window.onload = loadData;
</script>
</body>
</html>
