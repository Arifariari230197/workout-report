<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>üìù Laporan Mingguan Lucu & Friendly</title>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
    }

    window.addEventListener('DOMContentLoaded', () => {
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      const storedMode = localStorage.getItem('darkMode');
      if ((storedMode === null && prefersDark) || storedMode === 'true') {
        document.body.classList.add('dark-mode');
      }
    });
  </script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f8f9fa;
      color: #333;
      transition: background 0.5s, color 0.5s;
    }
    .dark-mode {
      background: #121212;
      color: #eee;
    }
    .card {
      max-width: 600px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .dark-mode .card {
      background: #1e1e1e;
    }
    input, select, button {
      padding: 10px;
      margin: 6px 0;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ddd;
    }
    th {
      background: #e9ecef;
    }
    .dark-mode th {
      background: #2a2a2a;
    }
    #statusChart {
      max-width: 300px;
      margin: 30px auto;
    }
    .floating-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      font-size: 28px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    }
  </style>
</head>
<body>
  <button onclick="toggleDarkMode()">üåì Mode</button>
  <h1>‚ú® Laporan Mingguan Ceria ‚ú®</h1>

  <div class="card">
    <label>Tanggal: <input type="date" id="tanggal"></label>
    <label>Hari: <input type="text" id="hari"></label>
    <label>Masalah: <input type="text" id="masalah"></label>
    <label>Eksekusi: <input type="text" id="eksekusi"></label>
    <label>Keterangan: <input type="text" id="keterangan"></label>
    <button onclick="tambahData()">‚ûï Tambah Data</button>
    <button onclick="exportExcel()">üìÅ Export Excel</button>
    <br><br>
    <label>Filter Status:
      <select id="filterStatus" onchange="renderTable()">
        <option value="">Semua</option>
        <option value="Belum Selesai">Belum Selesai</option>
        <option value="Proses">Proses</option>
        <option value="Selesai">Selesai</option>
      </select>
    </label>
    <table id="tabel">
      <thead>
        <tr>
          <th>Tanggal</th>
          <th>Hari</th>
          <th>Masalah</th>
          <th>Eksekusi</th>
          <th>Keterangan</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <canvas id="statusChart"></canvas>

  <script>
    let data = JSON.parse(localStorage.getItem('laporanMingguan')) || [];

    function tambahData() {
      const tanggal = document.getElementById("tanggal").value;
      const hari = document.getElementById("hari").value;
      const masalah = document.getElementById("masalah").value;
      const eksekusi = document.getElementById("eksekusi").value;
      const keterangan = document.getElementById("keterangan").value;

      data.push({ tanggal, hari, masalah, eksekusi, keterangan });
      localStorage.setItem("laporanMingguan", JSON.stringify(data));
      renderTable();
      updateChart();
    }

    function hapusData(index) {
      data.splice(index, 1);
      localStorage.setItem("laporanMingguan", JSON.stringify(data));
      renderTable();
      updateChart();
    }

    function renderTable() {
      const tbody = document.querySelector("#tabel tbody");
      const filter = document.getElementById("filterStatus").value;
      tbody.innerHTML = "";

      data.forEach((item, index) => {
        if (!filter || item.keterangan === filter) {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${item.tanggal}</td>
            <td>${item.hari}</td>
            <td>${item.masalah}</td>
            <td>${item.eksekusi}</td>
            <td>${item.keterangan}</td>
            <td><button onclick="hapusData(${index})">üóëÔ∏è</button></td>
          `;
          tbody.appendChild(row);
        }
      });
    }

    function exportExcel() {
      const ws_data = [["Tanggal", "Hari", "Masalah", "Eksekusi", "Keterangan"]];
      data.forEach(item => {
        ws_data.push([item.tanggal, item.hari, item.masalah, item.eksekusi, item.keterangan]);
      });
      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.aoa_to_sheet(ws_data);
      XLSX.utils.book_append_sheet(wb, ws, "Laporan");
      XLSX.writeFile(wb, "laporan-mingguan.xlsx");
    }

    function updateChart() {
      const counts = { "Selesai": 0, "Proses": 0, "Belum Selesai": 0 };
      data.forEach(item => {
        if (counts[item.keterangan] !== undefined) counts[item.keterangan]++;
      });

      const ctx = document.getElementById("statusChart").getContext("2d");
      if (window.statusChart) window.statusChart.destroy();
      window.statusChart = new Chart(ctx, {
        type: "doughnut",
        data: {
          labels: Object.keys(counts),
          datasets: [{
            data: Object.values(counts),
            backgroundColor: ["#28a745", "#ffc107", "#dc3545"]
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: "bottom" }
          }
        }
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      renderTable();
      updateChart();
    });
  </script>
</body>
</html>
